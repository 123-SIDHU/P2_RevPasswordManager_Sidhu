<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{layout :: head('Password Vault')}"></head>

<body>
    <div class="app-wrapper">
        <div th:replace="~{layout :: sidebar}" th:with="activePage='vault'"></div>
        <div class="main-content">
            <div th:replace="~{layout :: topbar('Password Vault')}" th:with="user=${user}"></div>
            <div class="page-body">
                <div th:replace="~{layout :: flash}"></div>

                <!-- Filter Bar -->
                <form method="get" th:action="@{/vault}" class="filter-bar mb-4">
                    <input type="text" name="search" class="form-control"
                        placeholder="üîç Search accounts, websites, usernames..." th:value="${search}"
                        style="max-width:300px;" />
                    <select name="sort" class="form-control" style="max-width:160px;" onchange="this.form.submit()">
                        <option value="name" th:selected="${sort == 'name'}">Sort: Name</option>
                        <option value="date_added" th:selected="${sort == 'date_added'}">Sort: Date Added</option>
                        <option value="date_modified" th:selected="${sort == 'date_modified'}">Sort: Modified</option>
                    </select>
                    <!-- View toggle -->
                    <input type="hidden" name="view" th:value="${view}" />
                    <button type="submit" class="btn btn-primary">Search</button>
                    <a th:if="${search != null and !#strings.isEmpty(search)}" href="/vault"
                        class="btn btn-secondary">Clear</a>
                </form>

                <!-- Category Chips -->
                <div class="filter-chips mb-4" style="margin-bottom:16px;">
                    <a th:href="@{/vault(sort=${sort})}" class="filter-chip"
                        th:classappend="${category == 'ALL'} ? 'active'">All</a>
                    <a th:each="cat : ${categories}" th:href="@{/vault(category=${cat.name()}, sort=${sort})}"
                        class="filter-chip" th:classappend="${category == cat.name()} ? 'active'"
                        th:text="${cat.name().replace('_',' ')}">Category</a>
                </div>

                <!-- Header Row -->
                <div class="card-header mb-4" style="margin-bottom:12px;">
                    <span style="font-size:13px;color:var(--text-secondary);"
                        th:text="${entries.size()} + ' entries'"></span>
                    <div style="display:flex;gap:8px;align-items:center;">
                        <!-- View toggle -->
                        <a th:href="@{/vault(search=${search},category=${category},sort=${sort},view='list')}"
                            class="btn-icon" title="List view" th:classappend="${view=='list'} ? 'active'"
                            style="font-size:16px;">‚ò∞</a>
                        <a th:href="@{/vault(search=${search},category=${category},sort=${sort},view='grid')}"
                            class="btn-icon" title="Grid view" th:classappend="${view=='grid'} ? 'active'"
                            style="font-size:16px;">‚äû</a>
                        <a href="/vault/add" class="btn btn-primary btn-sm">‚ûï Add Password</a>
                    </div>
                </div>

                <!-- Empty State -->
                <div th:if="${entries.empty}" style="text-align:center;padding:60px 24px;color:var(--text-muted);"
                    class="card fade-in">
                    <div style="font-size:50px;margin-bottom:12px;">üîí</div>
                    <p style="font-size:15px;margin-bottom:8px;">Your vault is empty</p>
                    <a href="/vault/add" class="btn btn-primary">‚ûï Add your first password</a>
                </div>

                <!-- GRID VIEW -->
                <div th:if="${view == 'grid' and !entries.empty}" class="vault-grid fade-in">
                    <div th:each="entry : ${entries}" style="position:relative;">
                        <a th:href="@{/vault/{id}(id=${entry.id})}" class="vault-card">
                            <div class="vault-card-header">
                                <div class="vault-card-icon">üîë</div>
                                <div>
                                    <span th:if="${entry.favorite}" style="font-size:13px;">‚≠ê</span>
                                    <span class="badge badge-purple" th:text="${entry.category}"></span>
                                </div>
                            </div>
                            <div class="vault-card-name" th:text="${entry.accountName}">Account</div>
                            <div class="vault-card-url text-muted" th:text="${entry.websiteUrl}"></div>
                            <div class="vault-card-user" th:text="${entry.accountUsername}"></div>
                        </a>
                        <!-- Favorite toggle -->
                        <form th:action="@{/vault/{id}/favorite(id=${entry.id})}" method="post"
                            style="position:absolute;top:12px;right:12px;">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <input type="hidden" name="returnUrl" value="/vault" />
                            <button type="submit" class="btn-icon" style="padding:4px 6px;font-size:13px;"
                                th:title="${entry.favorite} ? 'Remove from favorites' : 'Add to favorites'"
                                th:text="${entry.favorite} ? '‚≠ê' : '‚òÜ'"></button>
                        </form>
                    </div>
                </div>

                <!-- LIST VIEW -->
                <div th:if="${view != 'grid' and !entries.empty}" class="card fade-in">
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Account</th>
                                    <th>Website</th>
                                    <th>Username</th>
                                    <th>Category</th>
                                    <th>Modified</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="entry : ${entries}">
                                    <td>
                                        <div style="display:flex;align-items:center;gap:8px;">
                                            <span th:if="${entry.favorite}" title="Favorite">‚≠ê</span>
                                            <span class="fw-600" th:text="${entry.accountName}">Account</span>
                                        </div>
                                    </td>
                                    <td class="text-muted text-sm" th:text="${entry.websiteUrl}"></td>
                                    <td class="text-muted text-sm" th:text="${entry.accountUsername}"></td>
                                    <td><span class="badge badge-purple" th:text="${entry.category}"></span></td>
                                    <td class="text-muted text-sm" th:text="${entry.updatedAt}"></td>
                                    <td>
                                        <div style="display:flex;gap:6px;align-items:center;">
                                            <a th:href="@{/vault/{id}(id=${entry.id})}"
                                                class="btn btn-secondary btn-sm">View</a>
                                            <a th:href="@{/vault/{id}/edit(id=${entry.id})}"
                                                class="btn btn-secondary btn-sm">‚úèÔ∏è</a>
                                            <form th:action="@{/vault/{id}/favorite(id=${entry.id})}" method="post"
                                                style="display:inline;">
                                                <input type="hidden" th:name="${_csrf.parameterName}"
                                                    th:value="${_csrf.token}" />
                                                <input type="hidden" name="returnUrl" value="/vault" />
                                                <button type="submit" class="btn-icon btn-sm"
                                                    th:text="${entry.favorite} ? '‚≠ê' : '‚òÜ'"></button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div th:replace="~{layout :: scripts}"></div>
</body>

</html>